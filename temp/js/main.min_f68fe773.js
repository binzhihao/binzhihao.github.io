var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(o,r){function s(t){try{h(n.next(t))}catch(e){r(e)}}function a(t){try{h(n["throw"](t))}catch(e){r(e)}}function h(t){t.done?o(t.value):new i(function(e){e(t.value)}).then(s,a)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,r&&(s=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,r=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],r=0}finally{o=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,r,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},Action=function(t){function e(e,i,n){var o=t.call(this,e)||this;return o.priority=n.priority,o.toPAbody=n.toPAbody,o.type=Status.ACTION_MOVE,o.hero=i,o}return __extends(e,t),e.prototype.apply=function(){this.hero.PAbody=this.toPAbody},e.prototype.cancle=function(){this.hero.PAbody=!1},e}(egret.MovieClip);__reflect(Action.prototype,"Action");var Hero=function(t){function e(){var e=t.call(this)||this;return e.xSpeed=0,e.ySpeed=0,e.xAccaculate=0,e.yAccaculate=0,e.rotation=0,e._hp=0,e._max_hp=0,e._mp=0,e._max_mp=0,e.belongTo=0,e.couldMove=!0,e._hitStatus=!1,e._attackingStatus=!1,e.InvincibleStatus=!0,e.PAbody=!1,e.defense=!1,e.isjump=!1,e.willjump=!1,e.below=!1,e.run=!1,e._direction=!0,e.ignore_yAccaculate=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"desc",{get:function(){return this._desc},set:function(t){this._desc=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hp",{get:function(){return this._hp},set:function(t){0>=t&&(this.dispatchEvent(new egret.Event("dead")),t=0),this._hp=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max_hp",{get:function(){return this._max_hp},set:function(t){this._max_hp=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mp",{get:function(){return this._mp},set:function(t){this._mp=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max_mp",{get:function(){return this._max_mp},set:function(t){this._max_mp=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attackingStatus",{get:function(){return this._attackingStatus},set:function(t){this._attackingStatus=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitStatus",{get:function(){return this._hitStatus},set:function(t){this._hitStatus=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isjump",{get:function(){return this._isjump},set:function(t){this._isjump=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction!=t&&(this._direction=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!0,configurable:!0}),e.prototype.switchDirection=function(){this.direction=!this.direction,this.direction?this.skewY=0:this.skewY=180},e}(egret.DisplayObjectContainer);__reflect(Hero.prototype,"Hero",["CollsionTest","egret.DisplayObject"]);var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function o(t){e.call(n,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var ControlBtn=function(t){function e(){var e=t.call(this)||this;return e.tan=e.createBitmap("tang_png"),e.O=e.createBitmap("o_png"),e.rec=e.createBitmap("rect_png"),e.X=e.createBitmap("x_png"),e.addChild(e.tan),e.addChild(e.O),e.addChild(e.rec),e.addChild(e.X),e.reset(e.tan),e.reset(e.O),e.reset(e.rec),e.reset(e.X),e.tan.x=0,e.tan.y=-e.tan.height/1.413,e.X.x=0,e.X.y=e.tan.height/1.413,e.O.x=e.tan.width/1.413,e.O.y=0,e.rec.x=-e.tan.width/1.413,e.rec.y=0,e.start(),e.setOntouchTan(e.ontouchTan,e),e.setOntouchX(e.ontouchX,e),e.setOntouchO(e.OntouchO,e),e.scaleX=1.5,e.scaleY=1.5,e.tan.touchEnabled=!0,e.X.touchEnabled=!0,e.O.touchEnabled=!0,e.rec.touchEnabled=!0,e}return __extends(e,t),e.prototype.createBitmap=function(t){var e=new egret.Bitmap;return e.texture=RES.getRes(t),e},e.prototype.reset=function(t){t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2},e.prototype.setOntouchTan=function(t,e){this.tan.addEventListener(egret.TouchEvent.TOUCH_TAP,t,e)},e.prototype.setOntouchX=function(t,e){this.X.addEventListener(egret.TouchEvent.TOUCH_TAP,t,e)},e.prototype.setOntouchO=function(t,e){this.O.addEventListener(egret.TouchEvent.TOUCH_TAP,t,e)},e.prototype.setOntouchRec=function(t,e){this.rec.addEventListener(egret.TouchEvent.TOUCH_TAP,t,e)},e.prototype.removeOntouchTan=function(t,e){this.tan.removeEventListener(egret.TouchEvent.TOUCH_TAP,t,e)},e.prototype.removeOntouchX=function(t,e){this.X.removeEventListener(egret.TouchEvent.TOUCH_TAP,t,e)},e.prototype.removeOntouchO=function(t,e){this.O.removeEventListener(egret.TouchEvent.TOUCH_TAP,t,e)},e.prototype.removeOntouchRec=function(t,e){this.rec.removeEventListener(egret.TouchEvent.TOUCH_TAP,t,e)},e.prototype.ontouchTan=function(t){this.dispatchEvent(new egret.Event("btn_tan"))},e.prototype.ontouchX=function(t){this.dispatchEvent(new egret.Event("btn_x"))},e.prototype.OntouchO=function(){},e.prototype.start=function(){this.touchChildren=!0},e.prototype.stop=function(){this.touchChildren=!1},e}(egret.DisplayObjectContainer);__reflect(ControlBtn.prototype,"ControlBtn");var Controller=function(t){function e(){var e=t.call(this)||this;return e.btnG=new ControlBtn,e.addChild(e.btnG),e.btnG.x=950,e.btnG.y=500,e.bloodBar=new BloodBarComp,e.addChild(e.bloodBar),e.vj=new VirtualJoystick,e.addChild(e.vj),e}return __extends(e,t),e.prototype.setHero=function(t,e){this.bloodBar.setHero(t,e)},e}(egret.DisplayObjectContainer);__reflect(Controller.prototype,"Controller");var SceneManager=function(){function t(){}return t.Instance=new t,t.SCREEN_WIDTH=1136,t.SCREEN_HEIGHT=640,t}();__reflect(SceneManager.prototype,"SceneManager");var VirtualJoystick=function(t){function e(){var e=t.call(this)||this;return e.circleRadius=0,e.ballRadius=0,e.centerX=0,e.centerY=0,e.p1=new egret.Point,e.p2=new egret.Point,e.ball=new egret.Bitmap,e.ball.texture=RES.getRes("gan_core_png"),e.circle=new egret.Bitmap,e.circle.texture=RES.getRes("gan_home_png"),e.childrenCreated(),e.scaleX=1.7,e.scaleY=1.7,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.addChild(this.circle),this.addChild(this.ball),this.circleRadius=this.circle.height/2,this.ballRadius=this.ball.height/2,this.centerX=this.circleRadius,this.centerY=this.circleRadius,this.anchorOffsetX=this.circleRadius,this.anchorOffsetY=this.circleRadius,this.ball.x=this.centerX,this.ball.y=this.centerY,this.ball.anchorOffsetX=this.ballRadius,this.ball.anchorOffsetY=this.ballRadius,this.reset()},e.prototype.start=function(){SceneManager.Instance.rootStage.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),SceneManager.Instance.rootStage.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),SceneManager.Instance.rootStage.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this)},e.prototype.stop=function(){SceneManager.Instance.rootStage.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),SceneManager.Instance.rootStage.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),SceneManager.Instance.rootStage.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this)},e.prototype.onTouchBegin=function(t){t.stageX<SceneManager.SCREEN_WIDTH/2&&t.stageY>SceneManager.SCREEN_HEIGHT/2&&(this.touchID=t.touchPointID,this.x=t.stageX,this.y=t.stageY,this.ball.x=this.centerX,this.ball.y=this.centerY,SceneManager.Instance.rootStage.addChild(this),this.dispatchEvent(new egret.Event("vj_start")))},e.prototype.onTouchEnd=function(t){this.touchID==t.touchPointID&&t.stageX<SceneManager.SCREEN_WIDTH/2&&(this.reset(),this.dispatchEvent(new egret.Event("vj_end")))},e.prototype.onTouchMove=function(t){if(this.touchID==t.touchPointID&&t.stageX<SceneManager.SCREEN_WIDTH/2){this.p1.x=this.x,this.p1.y=this.y,this.p2.x=t.stageX,this.p2.y=t.stageY;var e=egret.Point.distance(this.p1,this.p2),i=Math.atan2(t.stageY-this.y,t.stageX-this.x);e<=this.circleRadius-this.ballRadius?(this.ball.x=this.centerX+t.stageX-this.x,this.ball.y=this.centerY+t.stageY-this.y):(this.ball.x=Math.cos(i)*(this.circleRadius-this.ballRadius)+this.centerX,this.ball.y=Math.sin(i)*(this.circleRadius-this.ballRadius)+this.centerY),this.dispatchEventWith("vj_move",!1,i)}},e.prototype.hide=function(){this.parent&&this.parent.removeChild(this)},e.prototype.reset=function(){this.x=150,this.y=500,this.ball.x=this.centerX,this.ball.y=this.centerY},e}(egret.DisplayObjectContainer);__reflect(VirtualJoystick.prototype,"VirtualJoystick");var CollisionEvent=function(t){function e(i,n,o,r,s){void 0===r&&(r=!1),void 0===s&&(s=!1);var a=t.call(this,e.type,r,s)||this;return a.collsionTest1=i,a.collsionTest2=n,a.intersectRect=o,a}return __extends(e,t),e.type="Collising",e}(egret.Event);__reflect(CollisionEvent.prototype,"CollisionEvent");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var o=RES.getRes(t);o?n(o):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Attack=function(t){function e(e,i,n){var o=t.call(this,e,i,n)||this;return o.damage=n.damage,o.damage_type=n.damage_type,o.repel_distance_xspeed=n.repel_distance_xspeed,o.description=n.description,o.PAbody_beat=n.PAbody_beat,o.damage_Area=new egret.Rectangle(n.damage_Area[0],n.damage_Area[1],n.damage_Area[2],n.damage_Area[3]),o.type=Status.ACTION_ATTACK,o}return __extends(e,t),e.prototype.apply=function(){this.hero.PAbody=this.toPAbody},e.prototype.cancle=function(){this.hero.PAbody=!1},e}(Action);__reflect(Attack.prototype,"Attack");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)});var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter);var i=new MainScene;this.stage.addChild(i),SceneManager.Instance.rootStage=this.stage,SceneManager.Instance.indexScene=i,this.touchEnabled=!0},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,platform.login()];case 1:return e.sent(),[4,platform.getUserInfo()];case 2:return t=e.sent(),console.log(t),[2]}})})},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var KCX=function(t){function e(){var e=t.call(this)||this;return e.actionMap={},e.usepriority=!0,e._hp=1e3,e._max_hp=1e3,e._mdata=RES.getRes("kcx_json"),e._texture=RES.getRes("kcx_png"),e.mcDataFactory=new egret.MovieClipDataFactory(e._mdata,e._texture),e.initAction(),e.switchAction("stand"),e}return __extends(e,t),e.prototype.initAction=function(){var t=RES.getRes("kcx_act_json"),e=RES.getRes("kcx_atk_json");for(var i in t.kcx.action){var n=e.kcx[t.kcx.action[i]],o=this.mcDataFactory.generateMovieClipData(t.kcx.action[i]);this.actionMap[t.kcx.action[i]]=new Action(o,this,n),this.action=this.actionMap[t.kcx.action[i]],this.action.anchorOffsetX=this.action.width/2,this.action.anchorOffsetY=this.action.height/2,this.action.anchorOffsetY+=RES.getRes("kcx_yfixed_json").kcx[t.kcx.action[i]]}for(var r in t.kcx.attack){var n=e.kcx[t.kcx.attack[r]];this.actionMap[t.kcx.attack[r]]=new Attack(this.mcDataFactory.generateMovieClipData(t.kcx.attack[r]),this,n),this.action=this.actionMap[t.kcx.attack[r]],this.action.anchorOffsetX=this.action.width/2,this.action.anchorOffsetY=this.action.height/2,this.action.anchorOffsetY+=RES.getRes("kcx_yfixed_json").kcx[t.kcx.attack[r]]}this.action=null},e.prototype.defaultAction=function(){this.blockSwitch=!1,this.attackingStatus=!1,this.usepriority=!1,this.switchAction("stand",-1),this.usepriority=!0},e.prototype.drawRect_d=function(){if(this.action.type==Status.ACTION_ATTACK){var t=this.action;this.shp&&this.removeChild(this.shp);var e=new egret.Shape;this.shp=e,e.graphics.lineStyle(10,65280),e.graphics.lineTo(t.damage_Area.x,-t.damage_Area.y),e.graphics.lineTo(t.damage_Area.x+t.damage_Area.width,-t.damage_Area.y),e.graphics.lineTo(t.damage_Area.x+t.damage_Area.width,-t.damage_Area.y+t.damage_Area.height),e.graphics.lineTo(t.damage_Area.x,-t.damage_Area.y+t.damage_Area.height),e.graphics.lineTo(0,0),e.graphics.lineTo(-this.width/2,-this.height/2),e.graphics.lineTo(this.width/2,this.height/2),this.addChild(e)}},e.prototype.switchAction=function(t,e,i,n){if(void 0===e&&(e=-1),void 0===i&&(i=this.defaultAction),void 0===n&&(n=this),this.current_status!=t&&!(null!=this.action&&this.usepriority&&this.action.priority<this.actionMap[t].priority)){this.current_status=t,this.playtimes=e,this.action&&this.action.parent&&this.removeChild(this.action),this.action=this.actionMap[t],this.addChild(this.action),this.action.once(egret.Event.COMPLETE,i,n),this.action.gotoAndPlay(0,e),this.action.type==Status.ACTION_ATTACK&&(this.attackingStatus=!0,this.dispatchEvent(new egret.Event("atk")));var o=new egret.Shape;this.addChild(o),o.graphics.lineStyle(10,65280),o.graphics.lineTo(0,0),this.addChild(o)}},e.prototype.jmp=function(t){this.isjump=!0,this.ySpeed=t,this.switchAction("jump",1)},e.prototype.getAtkRect=function(){return this.attackingStatus?null==this.action?null:this.action.type==Status.ACTION_ATTACK?this.action.damage_Area:null:null},e.prototype.applyAction=function(){return egret.log(this.attackingStatus),this.attackingStatus?(this.attackingStatus=!1,this.action.damage):0},e.prototype.toObj=function(){var t={};return t.hp=this.hp,t.x=this.x,t.y=this.y,t.current_status=this.current_status,t.blockSwitch=this.blockSwitch,t.playtimes=this.playtimes,t.ats=this.attackingStatus,t.direction=this.direction,t.rotation=this.rotation,t.desc=this.desc,t},e.prototype.applyObj=function(t){this.x=SceneManager.SCREEN_WIDTH-t.x,this.hp=t.hp,this.y=t.y,this.direction=!t.direction,this.switchAction(t.current_status,t.playtimes),this.blockSwitch=t.blockSwitch,this.rotation=-t.rotation},e.prototype.stop=function(){this.action.stop()},e.prototype.start=function(){this.action.play()},e.prototype.Instant_Shift=function(t,e){this.x=t,this.y=e},e.prototype.getCollsionBox=function(t){return this.getBounds(t),t.x=this.x-t.width/2,t.y=this.y-t.height/2,t},Object.defineProperty(e.prototype,"x",{get:function(){return t.prototype.$getX.call(this)},set:function(e){e>SceneManager.SCREEN_WIDTH&&(e=SceneManager.SCREEN_WIDTH),0>e&&(e=0),t.prototype.$setX.call(this,e)},enumerable:!0,configurable:!0}),e}(Hero);__reflect(KCX.prototype,"KCX");var ObjWapper=function(t){function e(e){var i=t.call(this)||this;return i._obj=e,i.id=0,i}return __extends(e,t),e.prototype.getCollsionBox=function(t){return this.obj.getBounds(t),t.x=this.obj.x-t.width/2,t.y=this.obj.y-t.height/2,t},Object.defineProperty(e.prototype,"visible",{get:function(){return this.obj.visible},set:function(t){this.obj.visible=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"obj",{get:function(){return this._obj},set:function(t){this._obj=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"desc",{get:function(){return this._desc},set:function(t){this._desc=t},enumerable:!0,configurable:!0}),e.prototype.toObj=function(){var t={};return t.x=this.obj.x,t.y=this.obj.y,t.rotation=this.obj.rotation,t.desc=this.desc,t.visible=this.obj.visible+"",t},e.prototype.applyObj=function(t){this.obj.x=SceneManager.SCREEN_WIDTH-t.x,this.obj.y=t.y,this.obj.rotation=-t.rotation,"false"==t.visible?this.obj.visible=!1:this.obj.visible=!0},e}(egret.DisplayObject);__reflect(ObjWapper.prototype,"ObjWapper",["CollsionTest","egret.DisplayObject"]);var Status=function(){function t(){}return t.ACTION_ATTACK="action_attack",t.ACTION_JUMP="action_jump",t.ACTION_MOVE="action_move",t.ACTION_DAMAGE_TYPE_AD="AD",t.ACTION_DAMAGE_TYPE_AP="AP",t}();__reflect(Status.prototype,"Status");var BattleMain=function(t){function e(){var e=t.call(this)||this;return e.Controller=new Controller,e.battleScene=new BattleScene("bg_jpg",e.Controller),e.addChild(e.battleScene),e.addChild(e.Controller),e}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(BattleMain.prototype,"BattleMain");var BattleScene=function(t){function e(e,i){var n=t.call(this)||this;n.displayDic={},n.speed=10,n.speedY_g=1.98,n.speedX_a=.25,n.blockRect=!1,n.blockcirc=!1,n.blockTest=!1,n.wan=!1,n.p1=new egret.Point,n.p2=new egret.Point,n.p3=new egret.Point,n.p4=new egret.Point,n.directionx=!0,n.directiony=!0,n.bg_img=new egret.Bitmap,n.bg_img.texture=RES.getRes(e),n.addChild(n.bg_img),n.hero1=new KCX,n.hero1.x=300,n.hero1.y=SceneManager.SCREEN_HEIGHT-n.hero1.height/2,n.hero1.id=1,n.addChild(n.hero1),n.hero2=new KCX,n.hero2.x=800,n.hero2.y=SceneManager.SCREEN_HEIGHT-n.hero2.height/2;var o=[1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],r=new egret.ColorMatrixFilter(o);n.hero2.filters=[r],n.addChild(n.hero2),n.hero2.switchDirection(),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.childrenCreated,n),WebSocketManager.Instance.x=400,n.addChild(WebSocketManager.Instance),n.controller=i,n.controller.setHero(n.hero1,n.hero2),n.flyer=new egret.Bitmap,n.flyer.texture=RES.getRes("dark01@2x_png"),n.addChild(n.flyer),n.flyer.visible=!1,n.flyer.anchorOffsetX=n.flyer.width/2,n.flyer.anchorOffsetY=n.flyer.height/2;var s=new ObjWapper(n.flyer);s.id=1;var a=new CollisionTestingPool(n);a.add(s),a.add(n.hero1),a.add(n.hero2),a.addEventListener(CollisionEvent.type,n.ans,n),n.addChild(a);var h=new egret.Bitmap;h.texture=RES.getRes("dark01@2x_png"),n.addChild(h),h.visible=!1,h.anchorOffsetX=h.width/2,h.anchorOffsetY=h.height/2,h.visible=!1;var c=new ObjWapper(h);return c.id=2,n.displayDic.hero=n.hero1,n.displayDic.dark01=s,n.displayDic["@@hero"]=n.hero2,n.displayDic["@@dark01"]=c,a.add(c),n.hero1.desc="hero",n.hero2.desc="@@hero",s.desc="dark01",c.desc="@@dark01",n}return __extends(e,t),e.prototype.rect=function(){if(!this.blockRect){this.blockRect=!0;var t=this.hero2.x;this.hero2.y;egret.Tween.get(this.hero1).to({x:t+200},500,egret.Ease.sineIn).call(function(){this.blockRect=!1},this)}},e.prototype.circ=function(){this.blockcirc||(this.blockcirc=!0,egret.Tween.get(this.hero1).to({x:this.hero1.x-200},120,egret.Ease.sineIn).call(function(){this.blockcirc=!1},this))},e.prototype.ans=function(t){var e=t.collsionTest1,i=t.collsionTest2;t.intersectRect,Math.random(),Math.random(),Math.random();if(i instanceof Hero)if(e instanceof Hero){var n=e.applyAction();i.hp=i.hp-n}else i.hp=i.hp-10},e.prototype.sendDic=function(){var t;for(t in this.displayDic)t.indexOf("@@")>=0||WebSocketManager.Instance.sendData(this.displayDic[t].toObj())},e.prototype.childrenCreated=function(){this.controller.vj.start(),this.controller.vj.addEventListener("vj_start",this.onStart,this),this.controller.vj.addEventListener("vj_move",this.onChange,this),this.controller.vj.addEventListener("vj_end",this.onEnd,this),this.controller.btnG.addEventListener("btn_tan",this.att,this),this.controller.btnG.addEventListener("btn_x",this.test,this),this.controller.btnG.setOntouchRec(this.rect,this),this.controller.btnG.setOntouchO(this.circ,this),this.addEventListener(egret.Event.ENTER_FRAME,this.physicsFrame,this),this.hero2.addEventListener("dead",this.onWin,this),this.hero1.addEventListener("dead",this.youLost,this),WebSocketManager.Instance.bindOnReceiveMessage(this.onGetDate,this)},e.prototype.test=function(){this.blockTest||(this.blockTest=!0,this.flyer.visible=!0,this.flyer.x=this.hero1.x,this.flyer.y=this.hero1.y,egret.Tween.get(this.flyer).to({x:this.hero1.x+1e3},1500,egret.Ease.sineIn).call(function(){this.flyer.visible=!1,this.blockTest=!1},this),egret.Tween.get(this.flyer).to({rotation:360},1500))},e.prototype.onGetDate=function(){var t=new egret.ByteArray;WebSocketManager.Instance.socket.readBytes(t);var e,i=t.readUTFBytes(t.bytesAvailable),n=JSON.parse(i);e=n.desc,null!=this.displayDic["@@"+e]&&this.displayDic["@@"+e].applyObj(n),this.setdirectionAndRole(this.hero2)},e.prototype.onWin=function(t){if(!this.wan){this.wan=!0;var e=new egret.TextField;e.text="You Win",this.addChild(e),e.textAlign="center",e.textColor=65280,e.size=80,e.x=this.stage.width/2-e.width,e.y=this.stage.height/2-e.height,this.controller.vj.stop(),this.controller.btnG.stop()}},e.prototype.youLost=function(t){if(!this.wan){this.wan=!0;var e=new egret.TextField;e.text="You Lost",this.addChild(e),e.textAlign="center",e.textColor=65280,e.size=80,e.x=this.stage.width/2-e.width,e.y=this.stage.height/2-e.height,this.controller.vj.stop(),this.controller.btnG.stop()}},e.prototype.att=function(t){if(this.hero1.attackingStatus=!0,this.hero1.switchAction("arm_attack",1),this.hero1.blockSwitch=!0,this.hero1.isjump){var e=Math.atan((this.hero1.y-this.hero2.y)/(this.hero1.x-this.hero2.x));this.hero1.rotation=e/Math.PI*180}},e.prototype.onStart=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},e.prototype.onChange=function(t){var e=t.data;this.hero1.xSpeed=Math.cos(e)*this.speed;var i=e/Math.PI*180;i>-145&&-45>i?this.hero1.willjump=!0:this.hero1.willjump=!1},e.prototype.onEnd=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.hero1.switchAction("stand"),this.hero1.willjump=!1},e.prototype.onEnterFrame=function(){this.hero1.blockSwitch||(this.hero1.x+=this.hero1.xSpeed,this.hero1.switchAction("walk",-1))},e.prototype.draw_boundingbox_d=function(t){var e=t.getBounds(),i=new egret.Shape;i.graphics.lineStyle(10,65280),i.graphics.lineTo(0,0),i.graphics.lineTo(e.width,0),i.graphics.lineTo(e.width,e.height),i.graphics.lineTo(0,0+e.height),i.graphics.lineTo(0,0),i.x=0,i.y=0,i.anchorOffsetX=e.width/2,i.anchorOffsetY=e.height/2,t.addChild(i)},e.prototype.physicsFrame=function(t){this.hero1.willjump&&!this.hero1.isjump&&this.hero1.jmp(-30),this.hero1.isjump&&this.hero1.hitStatus&&(this.hero1.rotation=-90),this.setdirectionAndRole(this.hero1),this.cacuFall(this.hero1),this.cacuFall(this.hero2),e.checkDirection(this.hero1,this.hero2),this.controller.bloodBar.update(),this.sendDic()},e.prototype.cacuFall=function(t){t.ySpeed+=this.speedY_g,t.y+=t.ySpeed,t.y>=SceneManager.SCREEN_HEIGHT-t.height/2&&(t.y=SceneManager.SCREEN_HEIGHT-t.height/2,t.ySpeed=0,t.isjump=!1,t.rotation=0)},e.checkDirection=function(t,e){t.x>e.x?t.direction=!1:t.direction=!0},e.prototype.setdirectionAndRole=function(t){t.direction?t.skewY=t.rotation:t.skewY=180+t.rotation},e.prototype.testAtk=function(){this.hero2.getAtkRect()&&this.checker(this.hero1,this.hero2)&&(this.hero1.hp-=this.hero2.applyAction())},e.checkColl=function(t,e){var i=t.getBounds(),n=e.getBounds().clone();return i.x=t.x,i.y=t.y,n.x=e.x,n.y=e.y,i.intersects(n)},e.prototype.checker=function(t,e){var i=t.getBounds(),n=e.getAtkRect();return i.x=t.x,i.y=t.y,e.localToGlobal(n.x,-n.y,this.p1),e.localToGlobal(n.x+n.width,-n.y,this.p2),e.localToGlobal(n.x,-n.y+n.height,this.p3),e.localToGlobal(n.x+n.width,-n.y+n.height,this.p4),t.hitTestPoint(this.p1.x,this.p1.y)||t.hitTestPoint(this.p2.x,this.p2.y)||t.hitTestPoint(this.p3.x,this.p3.y)||t.hitTestPoint(this.p4.x,this.p4.y)},e.prototype.stop=function(){this.scaleX=1.5,this.scaleY=1.5,this.x=1.5*-this.hero1.x,this.y=1.5*-this.hero1.y,this.y=this.y+this.hero1.height/2*1.5,this.x=this.x+this.hero1.width/2*1.5},e.prototype.goon=function(){this.hero1.start(),this.hero2.start(),this.controller.btnG.start(),this.controller.vj.start()},e.prototype.xshake=function(){this.directionx?this.x+=3:this.x-=3,Math.abs(this.x)>3&&(this.directionx=!this.directionx)},e.prototype.xshakecancle=function(){this.x=0},e.prototype.yshake=function(){this.directiony?this.y+=3:this.y-=3,Math.abs(this.y)>3&&(this.directiony=!this.directiony)},e.prototype.yshakecancle=function(){this.y=0},e}(egret.DisplayObjectContainer);__reflect(BattleScene.prototype,"BattleScene");var MainScene=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.loadResource()},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return n.sent(),this.stage.removeChild(t),e=new eui.Theme("resource/default.thm.json",this.stage),e.addEventListener(eui.UIEvent.COMPLETE,this.createGameScene,this),[3,4];case 3:return i=n.sent(),console.error(i),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){var t=this.createBitmapByName("bg_jpg");this.addChild(t);var e=this.stage.stageWidth,i=this.stage.stageHeight;t.width=e,t.height=i;var n=new egret.Shape;n.graphics.beginFill(0,.5),n.graphics.drawRect(0,0,e,172),n.graphics.endFill(),n.y=33,this.addChild(n);var o=new egret.TextField;o.textColor=16777215,o.width=e-172,o.textAlign="center",o.text="男の寝室斗♂戰-V0.0.2",o.size=64,o.x=100,o.y=80,this.addChild(o);var r=new egret.TextField;this.addChild(r),r.alpha=0,r.width=e-172,r.textAlign=egret.HorizontalAlign.CENTER,r.size=24,r.textColor=16777215,r.x=172,r.y=135,this.textfield=r;var s=new eui.Button;s.label="开始打架",s.horizontalCenter=0,s.verticalCenter=0,s.x=this.stage.width/2-20,s.y=this.stage.height/2-50,this.addChild(s),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStartGame,this);var a=new eui.Button;a.label="充钱",a.horizontalCenter=0,a.verticalCenter=0,a.x=this.stage.width/2-20,a.y=this.stage.height/2,this.addChild(a),a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.onStartGame=function(t){SceneManager.Instance.battleMain||(SceneManager.Instance.battleMain=new BattleMain),SceneManager.Instance.rootStage.removeChild(SceneManager.Instance.indexScene),SceneManager.Instance.rootStage.addChild(SceneManager.Instance.battleMain)},e.prototype.onButtonClick=function(t){var e=new eui.Panel;e.title="提示",e.horizontalCenter=0,e.verticalCenter=0;var i=new egret.TextField;i.text="充钱也不会变强",i.y=100,i.x=100,i.textAlign="center",i.textColor=0,e.addChild(i),e.x=350,e.y=this.stage.height/2-50,this.addChild(e)},e}(egret.DisplayObjectContainer);__reflect(MainScene.prototype,"MainScene");var BloodBar=function(t){function e(e,i){var n=t.call(this)||this;return n.amask=new egret.Bitmap,n.amask.texture=RES.getRes("mask_png"),n.xue_img=new egret.Bitmap,n.xue_img.texture=RES.getRes("xue_png"),n.xue_border=new egret.Bitmap,n.xue_border.texture=RES.getRes("xue_border_png"),n.addChild(n.xue_img),n.addChild(n.xue_border),n.scaleX=e,n.hero=i,n.text=new egret.TextField,n.text.text=n.hero.hp+"",n.text.textAlign="center",n.text.textColor=255,n.addChild(n.text),n}return __extends(e,t),e.prototype.update=function(){this.xue_img.x=-this.amask.width+this.hero.hp/this.hero.max_hp*this.amask.width,this.xue_img.mask=this.amask,this.addChild(this.amask),this.text.text=this.hero.hp+""},e}(egret.DisplayObjectContainer);__reflect(BloodBar.prototype,"BloodBar");var BloodBarComp=function(t){function e(){var e=t.call(this)||this;return e.timer_num=60,e.timer_Text=new egret.TextField,e.timer_Text.text=e.timer_num+"",e.timer_Text.x=600,e.timer_Text.textColor=16776960,e.addChild(e.timer_Text),e.timer=new egret.Timer(1e3,60),e.timer.addEventListener(egret.TimerEvent.TIMER,e.timerupdate,e),e.timer.start(),e}return __extends(e,t),e.prototype.update=function(){this.bloodBar.update(),this.bloodBar2.update()},e.prototype.timerupdate=function(){this.timer_num-=1,this.timer_Text.text=this.timer_num+""},e.prototype.setHero=function(t,e){this.h1=t,this.h2=e,this.bloodBar=new BloodBar(2,this.h1),this.addChild(this.bloodBar),this.bloodBar2=new BloodBar(2,this.h2),this.addChild(this.bloodBar2),this.bloodBar2.x=820},e}(egret.DisplayObjectContainer);__reflect(BloodBarComp.prototype,"BloodBarComp");var CollisionTestingPool=function(t){function e(e){var i=t.call(this)||this;return i.pool1=[],i.pool2=[],i.boundingBox1=new egret.Rectangle(0,0,0,0),i.boundingBox2=new egret.Rectangle(0,0,0,0),i.shp1=new egret.Shape,i.shp2=new egret.Shape,i.rootContainer=e,i.size1=0,i.size2=0,i.addEventListener(egret.Event.ENTER_FRAME,i.run,i),i.rootContainer.addChild(i.shp1),i.rootContainer.addChild(i.shp2),i}return __extends(e,t),e.prototype.add=function(t){1==t.id?this.pool1[this.size1++]=t:this.pool2[this.size2++]=t},e.prototype.remove=function(t){1==t.id?this.pool1.forEach(function(e,i,n){e==t&&delete n[i]}):this.pool2.forEach(function(e,i,n){e==t&&delete n[i]})},e.prototype.drawCollsionBox=function(t,e){t.getCollsionBox(this.boundingBox1),e.graphics.drawRect(this.boundingBox1.x,this.boundingBox1.y,this.boundingBox1.width,this.boundingBox1.height)},e.prototype.drawAll=function(){var t=this;this.pool1.forEach(function(e,i,n){t.drawCollsionBox(e,t.shp1)}),this.pool2.forEach(function(e,i,n){t.drawCollsionBox(e,t.shp2)})},e.prototype.run=function(){var t=this;this.shp1.graphics.clear(),this.shp1.graphics.lineStyle(5,65280),this.shp2.graphics.clear(),this.shp2.graphics.lineStyle(5,16711680),this.pool2.forEach(function(e,i,n){e.getCollsionBox(t.boundingBox1),e.visible&&t.pool1.forEach(function(i,n,o){if(i.visible&&(i.getCollsionBox(t.boundingBox2),t.boundingBox2.intersects(t.boundingBox1))){var r=new CollisionEvent(e,i,t.boundingBox2.intersection(t.boundingBox1)),s=t.boundingBox2.intersection(t.boundingBox1);
t.shp1.graphics.drawRect(s.x,s.y,s.width,s.height),t.dispatchEvent(r)}})})},e}(egret.DisplayObjectContainer);__reflect(CollisionTestingPool.prototype,"CollisionTestingPool");var WebSocketManager=function(t){function e(){var e=t.call(this)||this;return e.success=!1,e.text=new egret.TextField,e.text.textColor=16711680,e.addChild(e.text),e.initWebSocket(),e}return __extends(e,t),e.prototype.initWebSocket=function(){this.socket=new egret.WebSocket,this.socket.type=egret.WebSocket.TYPE_BINARY,this.socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),this.socket.connectByUrl("ws://101.200.42.121:8088/websocket")},e.prototype.sendData=function(t){var e=new egret.ByteArray,i=t;e.writeUTFBytes(JSON.stringify(i)),e.position=0;e.readUTFBytes(e.bytesAvailable);this.socket.writeBytes(e,0,e.bytesAvailable)},e.prototype.onSocketOpen=function(){this.trace("WebSocketOpen"),this.success=!0,this.text.text="连接状态"+this.success},e.prototype.onSocketClose=function(){this.trace("WebSocketClose"),this.success=!1,this.text.text="连接状态"+this.success},e.prototype.onSocketError=function(){this.trace("WebSocketError"),this.success=!1,this.text.text="连接状态传输错误"},e.prototype.onReceiveMessage=function(t){var e=new egret.ByteArray;this.socket.readBytes(e);var i=e.readUTFBytes(e.bytesAvailable);this.trace("收到数据:"),this.trace("readUTF : "+i)},e.prototype.trace=function(t){},e.prototype.bindOnReceiveMessage=function(t,e){this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,t,e)},e.Instance=new e,e}(egret.DisplayObjectContainer);__reflect(WebSocketManager.prototype,"WebSocketManager");